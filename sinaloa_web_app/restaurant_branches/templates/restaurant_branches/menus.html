{% load static %}

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Men칰 del Restaurante</title>
    <!-- CSS de Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="{% static 'estilos/menus.css' %}">

    <style>
      /* Estilos para la barra de navegaci칩n del men칰 */
      .nav-menu {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
      }

      /* Ocultar todas las secciones de men칰 al inicio */
      .menu-section {
        display: none;
      }

      /* Mostrar solo la secci칩n activa */
      .menu-section.active {
        display: block;
      }

      /* Estilos para el chat bot*/
      .chatbot-container {
        z-index: 1050;
      }
    </style>
    
    <!-- Script de Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  </head>

  <body>
    <!-- Encabezado principal -->
    <header>
      <h1>Men칰 Especial</h1>
      <p>Todos nuestros platillos son preparados al momento</p>
    </header>

    <!-- Barra de b칰squeda -->
    <div class="group">
      <svg viewBox="0 0 24 12" aria-hidden="true" class="search-icon">
        <g>
          <path d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z"></path>
        </g>
      </svg>
      <input id="query" class="input" type="search" placeholder="Buscar" name="searchbar" />
    </div>

    <!-- Barra de navegaci칩n -->
    <div class="nav-opciones">
      {% for type, categories in grouped_categories.items %}
        <div class="btn-group">
          <button type="button" class="btn btn-secondary" onclick="mostrarTodas('{{ type }}')">
            {{ type|title }}
          </button>
          <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
            <span class="visually-hidden">Toggle Dropdown</span>
          </button>
          <ul class="dropdown-menu">
            {% for category in categories %}
              <li>
                <a class="dropdown-item" href="#" onclick="mostrarCategoria('{{ category.slug }}')">
                  {{ category.name }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% empty %}
        <p>No hay categorias</p> 
      {% endfor %}
    </div>
    
    <!-- Secci칩n para mostrar platillos -->
    <div id="menu-dishes">
      {% for category, dishes in dishes_by_category.items %}
        {% if dishes %}
          <div class="menu-section" id="{{ category.slug }}" data-type="{{ category.type }}">
            <h3>{{ category.name }}</h3>
            <div class="menu-grid">
              {% for dish in dishes %}
                <div class="menu-item">
                  <img src="{{ dish.img.url }}" alt="{{ dish.name }}" loading="lazy" />
                  <h3>{{ dish.name }}</h3>
                  <p>{{ dish.description }}</p>
                  <span class="price">${{ dish.price }}</span>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      {% empty %}
        <p>No hay platillos</p> 
      {% endfor %}
    </div>
   
    <!-- Bot칩n fijo para reabrir el chat -->
    <button id="reopen-chat-btn" class="btn btn-primary position-fixed bottom-0 end-0 m-3"
    style="z-index: 1060;" onclick="toggleChat()">
    游눫 Chat
    </button>

    <!-- Ventana de Chat flotante -->
    <div class="chatbot-container position-fixed bottom-0 end-0 p-3">
      <div class="card border-primary shadow-lg d-none" id="chatbot-card" style="width: 300px;">
        <div class="card-header bg-primary text-white d-flex justify-content-between">
          <span>Chat del Restaurante</span>
          <button class="btn-close btn-close-white" onclick="toggleChat()" aria-label="Cerrar"></button>
        </div>
        <div class="card-body" id="chatbot-body" style="height: 400px; overflow-y: auto;">
          <p class="text-muted">Preg칰ntanos cualquier cosa sobre el men칰 o la sucursal.</p>
        </div>
        <div class="card-footer">
          <div class="input-group">
            <input type="text" id="chatbot-input" class="form-control" placeholder="Escribe tu pregunta...">
            <button class="btn btn-primary" onclick="sendMessage()">Enviar</button>
          </div>
        </div>
      </div>
    </div>
    


    <!-- Pie de p치gina -->
    <footer>
      <!-- Contenedor de Contacto -->
      <div class="contacto">
        <h3>Contacto</h3>
        <p>Tel칠fono: +52 123 456 7890</p>
        <p>Correo: contacto@example.com</p>
      </div>

      <!-- Contenedor de Horarios -->
      <div class="horarios">
        <h3>Horarios</h3>
        <p>Lunes a Viernes: 8:00 AM - 6:00 PM</p>
        <p>S치bado: 9:00 AM - 3:00 PM</p>
      </div>

      <!-- Lista de 칤conos -->
      <ul class="wrapper">
        <!-- 칈cono 1 -->
        <li class="icon">
          <a
            href="https://www.facebook.com"
            target="_blank"
            aria-label="Facebook"
          >
            <!-- Agrega aqu칤 el SVG o FontAwesome del 칤cono -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M22.675 0H1.325C.593 0 0 .592 0 1.324v21.352C0 23.406.593 24 1.325 24H12.82v-9.294H9.691v-3.622h3.128V8.413c0-3.1 1.894-4.788 4.66-4.788 1.325 0 2.462.098 2.795.142v3.243l-1.918.001c-1.504 0-1.795.714-1.795 1.762v2.31h3.587l-.467 3.622h-3.12V24h6.116C23.406 24 24 23.406 24 22.676V1.324C24 .592 23.406 0 22.675 0z"
              />
            </svg>
          </a>
        </li>

        <!-- 칈cono 2 -->
        <li class="icon">
          <a
            href="https://www.instagram.com"
            target="_blank"
            aria-label="Instagram"
          >
            <!-- Agrega aqu칤 el SVG o FontAwesome del 칤cono -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path
                d="M12 2.163c3.204 0 3.584.012 4.85.07 1.366.062 2.633.332 3.608 1.308.975.975 1.246 2.242 1.308 3.608.058 1.266.069 1.645.069 4.85s-.012 3.584-.069 4.85c-.062 1.366-.332 2.633-1.308 3.608-.975.975-2.242 1.246-3.608 1.308-1.266.058-1.645.069-4.85.069s-3.584-.012-4.85-.069c-1.366-.062-2.633-.332-3.608-1.308-.975-.975-1.246-2.242-1.308-3.608C2.175 15.584 2.163 15.204 2.163 12s.012-3.584.07-4.85c.062-1.366.332-2.633 1.308-3.608C4.517 2.495 5.784 2.225 7.15 2.163c1.266-.058 1.646-.07 4.85-.07M12 0C8.741 0 8.332.015 7.052.072 5.73.13 4.388.396 3.363 1.421c-1.025 1.025-1.291 2.367-1.349 3.689C1.983 6.967 1.968 7.376 1.968 12s.015 5.033.072 6.312c.058 1.322.324 2.664 1.349 3.689 1.025 1.025 2.367 1.291 3.689 1.349C8.333 23.985 8.742 24 12 24s3.668-.015 4.948-.072c1.322-.058 2.664-.324 3.689-1.349 1.025-1.025 1.291-2.367 1.349-3.689.058-1.279.072-1.688.072-6.312s-.015-5.033-.072-6.312c-.058-1.322-.324-2.664-1.349-3.689C19.664.396 18.322.13 17.052.072 15.772.015 15.363 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zm0 10.162a3.999 3.999 0 110-7.998 3.999 3.999 0 010 7.998zm6.406-11.845a1.44 1.44 0 100-2.881 1.44 1.44 0 000 2.881z"
              />
            </svg>
          </a>
        </li>
      </ul>
    </footer>

    <!-- JavaScript para manejar la interactividad -->
    <script>
      function toggleChat() {
        const chatCard = document.getElementById('chatbot-card');
        const reopenButton = document.getElementById('reopen-chat-btn');
        
        // Alternar visibilidad
        if (chatCard.classList.contains('d-none')) {
          chatCard.classList.remove('d-none'); // Mostrar chat
          reopenButton.classList.add('d-none'); // Ocultar bot칩n
        } else {
          chatCard.classList.add('d-none'); // Ocultar chat
          reopenButton.classList.remove('d-none'); // Mostrar bot칩n
        }
      }

      async function sendMessage() {
        const input = document.getElementById('chatbot-input');
        const message = input.value.trim();
        if (!message) return;

        // Mostrar mensaje del usuario
        const chatBody = document.getElementById('chatbot-body');
        chatBody.innerHTML += `<div><strong>T칰:</strong> ${message}</div>`;
        input.value = '';
        
        // Realizar consulta al servidor
        const response = await fetch(`/handle_user_query?prompt=${encodeURIComponent(message)}`);
        const data = await response.json();

        // Mostrar respuesta del servidor
        if (data.answer) {
          chatBody.innerHTML += `<div><strong>Sinaloa Asistente:</strong> <p>${data.answer}</p></div>`;
        } else {
          chatBody.innerHTML += `<div><strong>Sinaloa Asistente:</strong> <p>Lo siento, no pude encontrar una respuesta.</p></div>`;
        }
        chatBody.scrollTop = chatBody.scrollHeight;
      }


      document.addEventListener("DOMContentLoaded", () => {
        const sections = document.querySelectorAll(".menu-section");

        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add("active");  // Agrega la clase active cuando sea visible
              observer.unobserve(entry.target);      // Deja de observar una vez que se muestra
            }
          });
        });

        sections.forEach(section => observer.observe(section));
      });


      
      function mostrarTodas(type) {
        // Obtener todas las secciones del men칰
        const sections = document.querySelectorAll(".menu-section");
        
        // Ocultar todas las secciones primero
        sections.forEach((section) => section.classList.remove("active"));
        
        // Mostrar solo las secciones cuyo data-type coincide con el tipo
        sections.forEach((section) => {
          if (section.getAttribute("data-type") === type) {
            section.classList.add("active");
          }
        });
      }


      function mostrarCategoria(slug) {
          // Ocultar todas las secciones
          const sections = document.querySelectorAll(".menu-section");
          sections.forEach((section) => section.classList.remove("active"));

          // Mostrar solo la secci칩n correspondiente al slug
          const section = document.getElementById(slug);
          if (section) {
            section.classList.add("active");
          }
      }
    </script>
  </body>
</html>
